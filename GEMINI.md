# Gemini CLI Instructions for cellmech Project

This document outlines the operational guidelines and project-specific conventions for the Gemini CLI when interacting with the `cellmech` project.

## Project Overview
The `cellmech` project is a Python-based library focused on cell mechanics, involving image processing, data analysis, and GUI applications (using `pyqt6`). It uses Poetry for dependency management and `pytest` for testing. Jupyter notebooks (`demonstration.ipynb`, `tractionforce.ipynb`) provide demonstrative aspects to the project.

## Application Architecture
The `cellmech` library is structured as a modular pipeline for **Traction Force Microscopy (TFM)**:

*   **Image Processing Layer (`cellmech/imgproc/`):**
    *   `bead_detection.py`: Uses multi-scale correlation and Sum of Squared Differences (SSD) to extract displacement fields (Ux, Uy) from fluorescent bead images.
    *   `cell_detection.py`: Employs OpenCV-based segmentation (Canny, Contours) to define cell boundaries and regions of interest.
*   **Core Mechanics Layer (`cellmech/mechanics.py`):**
    *   Implements **Fourier Transform Traction Cytometry (FTTC)** using Green's functions (Boussinesq solution) to convert displacement fields into traction force fields (Fx, Fy).
    *   Provides Tikhonov regularization for noise management and tensile strain field calculations.
*   **Data & Simulation Layer:**
    *   `beads_generator.py`: Generates synthetic bead images and known displacement fields for validation.
    *   The system is primarily exposed via a Python API used in Jupyter notebooks (`examples/`), with `PyQt6` available for GUI-based wrappers.

## Key Directories and Their Purpose

*   `cellmech/`: Main module containing the core source code.
    *   `cellmech/imgproc/`: Contains image processing modules (e.g., `bead_detection.py`, `cell_detection.py`).
*   `tests/`: Contains all relevant unit and integration tests.
*   `examples/`: Contains demonstrative Jupyter notebooks and examples.
*   `data/`: Stores data used or generated by the project (e.g., `.npy` files).
*   `images/`: Stores image assets for testing, examples, and processing.
*   `__pycache__/`, `.git/`, `.pytest_cache/`, `dist/`: Standard environment/build-related directories.

## Key Files and Their Purpose

*   `pyproject.toml`: Project configuration, dependency management (Poetry), and build system definition.
*   `poetry.lock`: Locks the exact versions of project dependencies.
*   `README.md`: Project description and basic usage instructions.
*   `LICENSE`: Project licensing information (MIT).
*   `Taskfile.yml`: Automation script for common tasks (testing, setup).
*   `Dockerfile`: Docker image definition for environment replication and CI.
*   `.github/workflows/ci.yml`: GitHub Actions pipeline for automated building and testing.

## Automation & Workflow

### Taskfile Commands
Use the `task` runner for common operations:
*   `task test_prepare [ENABLE_VISUAL_TESTING=0|1]`: Sets up the environment for tests.
*   `task test_run`: Runs all tests via `poetry run python3 -m pytest -s`.
*   `task run <testname>`: Runs a specific test by name (appends `-k <testname>` to the test command).

### CI Pipeline
The GitHub CI pipeline:
1.  Builds a Docker image that replicates the environment defined in `pyproject.toml`.
2.  Runs a Docker container based on that image.
3.  Executes all tests inside the container.

## Technologies and Conventions

*   **Language:** Python 3.12+
*   **Dependency Management:** Poetry. Always use `poetry add` or `poetry install`.
*   **Testing Framework:** `pytest`. Use `task test_run` for verification.
*   **Coding Style:** Adhere to PEP 8.
*   **Image Processing:** `opencv-python`, `pillow`.
*   **Numerical Operations:** `numpy`, `scipy`.
*   **GUI:** `pyqt6`.

## Operating Instructions for Gemini CLI

1.  **Before Modifying Code:** Always read relevant files to understand local conventions and dependencies.
2.  **When Adding Features/Fixing Bugs:**
    *   Prioritize adding or updating tests in the `tests/` directory.
    *   Verify changes using `task test_run`.
    *   Ensure consistency with the existing codebase's style and structure.
3.  **Dependency Management:** Use `poetry add <package_name>` for new requirements.
4.  **Security:** Adhere to security best practices; never expose sensitive information.

This `GEMINI.md` file serves as a dynamic guide. It should be updated as new insights into the project's structure, conventions, or tooling emerge.
